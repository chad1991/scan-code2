<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üì∑ Barcode Scanner Logsheet</title>

  <!-- Quagga (1D) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
  <!-- ZXing (2D/QR & many formats) -->
  <script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.18.6/umd/index.min.js"></script>
  <!-- SheetJS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <style>
    body { font-family: Arial, sans-serif; padding: 10px; text-align: center; }
    #cameraPreview {
      width: 320px; height: 240px;
      border: 3px solid #333; border-radius: 8px;
      background: black; margin: 15px auto; display: block;
    }
    #result { margin-top: 10px; font-weight: bold; }
    .actions { display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; justify-content: center; }
    .actions button { flex: 1; min-width: 120px; padding: 8px; border-radius: 6px; border: none; cursor: pointer; }
    #entriesList { list-style: none; padding: 0; margin-top: 15px; text-align: left; }
    #entriesList li {
      margin: 6px 0; padding: 6px;
      background: #f9f9f9; border-radius: 6px;
      display: flex; justify-content: space-between; align-items: center;
    }
    #entriesList input { width: 60px; margin-left: 6px; }
    #manualForm {
      margin-top: 15px; padding: 10px; border: 1px solid #ccc;
      border-radius: 6px; display: inline-block; text-align: left;
    }
    #manualForm input { padding: 6px; margin: 4px; width: 140px; }
    #manualForm button {
      padding: 6px 10px; margin: 4px; border: none; border-radius: 6px;
      cursor: pointer; background: #007bff; color: white;
    }
    #batchesList { list-style: none; padding: 0; margin-top: 15px; text-align: left; }
    #batchesList li {
      margin: 6px 0; padding: 6px;
      background: #eef; border-radius: 6px;
      display: flex; justify-content: space-between; align-items: center;
    }
    #batchesList button {
      margin-left: 6px; padding: 2px 6px;
      border: none; border-radius: 4px;
      cursor: pointer;
    }
    #batchesList button.view { background: #007bff; color: white; }
    #batchesList button.delete { background: crimson; color: white; }

    /* Modal */
    #batchModal {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6); display: none;
      align-items: center; justify-content: center; z-index: 1000;
    }
    #batchModal .modal-content {
      background: white; padding: 20px; border-radius: 8px;
      width: 90%; max-width: 500px; text-align: left;
    }
    #batchModal h3 { margin-top: 0; }
    #batchModal table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    #batchModal th, #batchModal td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    #batchModal button { margin-top: 10px; padding: 6px 12px; background: #444; color: white; border: none; border-radius: 4px; cursor: pointer; }
  </style>
</head>
<body>
  <h2>üì∑ Barcode Scanner</h2>

  <!-- Camera Preview -->
  <video id="cameraPreview" autoplay playsinline muted></video>

  <!-- Scan Mode Selector -->
  <div style="margin-top:10px;">
    <label><strong>Scan Mode:</strong></label>
    <select id="scanModeSelect" onchange="switchMode(this.value)">
      <option value="1d">1D Only</option>
      <option value="2d">2D Only</option>
      <option value="all" selected>All</option>
    </select>
  </div>

  <!-- Batch Header -->
  <div id="batchHeader" style="margin-top:15px; padding:10px; border:1px solid #ccc; border-radius:6px; display:inline-block; text-align:left;">
    <h4>üìù Batch Header</h4>
    <label>Date: <input type="date" id="logDate"></label><br><br>
    <label>Store: <input type="text" id="storeName" placeholder="Store Name"></label><br><br>
    <label>Discount: <input type="number" id="discount" value="0" min="0" max="100"> %</label>
  </div>

  <p id="result">Scan a barcode...</p>

  <div class="actions">
    <button type="button" onclick="startScanner()">‚ñ∂Ô∏è Restart</button>
    <button type="button" onclick="toggleCamera()">üîÑ Toggle Camera</button>
    <button type="button" onclick="stopScanner()">‚èπ Stop</button>
    <button type="button" onclick="downloadExcel()">üíæ Save Excel</button>
    <button type="button" onclick="clearHistory()">üóëÔ∏è Clear All</button>
    <button type="button" onclick="nextBatch()">‚û°Ô∏è Next</button>
  </div>

  <!-- Beep Sounds -->
  <audio id="beepSuccess" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>
  <audio id="beepError" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

  <!-- Manual Entry -->
  <div id="manualForm">
    <h4>‚úçÔ∏è Manual Entry</h4>
    <input type="text" id="manualBarcode" placeholder="Barcode" />
    <input type="number" id="manualQty" placeholder="Qty" min="1" value="1" />
    <input type="number" id="manualPrice" placeholder="Price" step="0.01" />
    <button onclick="addManualEntry()">Add</button>
  </div>

  <h3>üìã Saved Entries</h3>
  <ul id="entriesList"></ul>

  <h3>üì¶ Saved Batches</h3>
  <ul id="batchesList"></ul>

  <!-- Batch Modal -->
  <div id="batchModal">
    <div class="modal-content">
      <h3 id="modalTitle"></h3>
      <p id="modalHeader"></p>
      <table>
        <thead><tr><th>Barcode</th><th>Qty</th><th>Price</th></tr></thead>
        <tbody id="modalTableBody"></tbody>
      </table>
      <button onclick="closeModal()">Close</button>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
